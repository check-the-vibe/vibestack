OS Inventory
===========

Purpose
- Quick inventory of repository files and code paths that make OS-specific assumptions
  (package managers, init systems, display servers, hardcoded paths, use of sudo).

Method
- Grep search for common tokens (`supervisord`, `supervisorctl`, `Xvfb`, `novnc`, `xfce4`,
  `systemctl`, `apt`, `yum`, shell paths, `Dockerfile`, `ENTRYPOINT`).

Summary Findings
- Supervisord is used widely; several places call `supervisorctl` or reference
  `supervisord.conf` (streamlit UI, assets, startup templates).
- GUI stack (Xvfb, xfce4, noVNC) is configured in `supervisord.conf` and related
  startup scripts; these assume an X11-compatible environment.
- Several helper scripts and code invoke `sudo` for `supervisorctl` (assets and
  streamlit pages assume privilege escalation to query supervisor). Prefer `python -m vibestack.scripts.supervisor_helper` to centralize handling of privilege detection.
- Dockerfile and `entrypoint.sh` / `startup.sh` are present and will need package
  mapping adjustments for a different base image / package manager.
- `bin/` contains CLI helpers that may assume typical Linux paths and shell behavior.

Files of Interest (brief notes & suggested remediation)
- `supervisord.conf`
  - Contains programs: `xvfb`, `novnc`, `xfce4` with hardcoded `DISPLAY` and
    log paths under `/var/log/supervisor`.
  - Suggestion: parameterize program enabling via env vars and make log paths
    configurable (use `%(ENV_SOMETHING)s`), and provide systemd unit template
    alternative if target OS prefers `systemd`.

- `vibestack/assets/startup/supervisor_log_viewer.py`
  - Previously used `sudo supervisorctl status` and `tail`.
  - Suggestion: remove hardcoded `sudo` and call the centralized helper `python -m vibestack.scripts.supervisor_helper` which handles privilege detection and fallbacks. If that is not available, consider reading logs directly when permissions allow.

- `streamlit_app/pages/*` and `streamlit_app/common.py`
  - Multiple places shell out to `sudo supervisorctl` and parse `supervisord.conf`.
  - Suggestion: centralize supervisor queries behind a helper that handles privilege
    detection and falls back gracefully.

- `supervisord.conf` (again)
  - `novnc` command uses `/usr/share/novnc/` and `websockify` binaries; ensure
    those paths exist on target OS or make them configurable.

- `xfce-startup` script
  - Shebang uses `/bin/bash`; XFCE4 startup assumes `DISPLAY=:0` and user home at
    `/home/vibe`.
  - Suggestion: ensure portable shebangs and avoid hardcoded HOME in startup logic.

- `Dockerfile`, `entrypoint.sh`, `startup.sh`
  - May contain `FROM` lines and platform-specific install commands (apt-get).
  - Suggestion: audit package manager usage and prepare alternative install steps
    or use multi-stage builds with distro-specific base images.

- `bin/*` (e.g., `vibe`)
  - CLI helpers may assume specific shell features or available system binaries.
  - Suggestion: add detection for `bash` vs `dash`, validate required binaries early,
    and provide helpful error messages if missing.

- `configure-user.sh` and other ops scripts
  - Might call `useradd`, set permissions, or assume `/home` layout.
  - Suggestion: make user-related operations optional and parameterized.

- Tests and CI
  - Tests assume a Linux environment; CI may need matrix adjustments for target OS.
  - Suggestion: add CI job that builds image and runs smoke tests on the target base.

Priority Items (shortlist)
1. Parameterize/remediate `supervisord.conf` and supervisorctl usage (high).
2. Audit `Dockerfile` for package manager and native deps (high).
3. Make GUI sessions opt-in and document X11/Wayland requirements (medium).
4. Centralize supervisor interaction behind a helper that handles privileges (medium).

Next Steps
- Produce `docs/os_assumptions.md` mapping package/service/path differences (I will
  start this next).
- Prepare `docs/docker_migration.md` with a short plan to support alternative base images.

Notes
- This inventory is not exhaustive; next step is to open each listed file and
  capture exact lines and suggested code edits to be applied in follow-up PRs.

Generated by: repo scan initiated for OS migration work.
